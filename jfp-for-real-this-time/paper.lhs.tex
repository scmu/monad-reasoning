\documentclass{jfp}

 \DeclareTextCommandDefault{\nobreakspace}{\leavevmode\nobreak\ }
\input{macros.tex}
\let\Bbbk\undefined
%include polycode.fmt
%include forall.fmt
%include fmts/symbols.fmt

\usepackage{thm-restate}

% add margin before code
\usepackage{enumitem}
\newlist{qwq}{itemize}{1}
\setlist[qwq]{label={}, nosep, leftmargin=1em}
\newcommand{\indentbegin}{\begin{qwq} \item}
\newcommand{\indentend}{\end{qwq}}
%subst code a = "\indentbegin \begin{hscode}\SaveRestoreHook'n" a "\ColumnHook'n\end{hscode}\resethooks'n\indentend "
% NOTE: The above line is not a comment. It is a lhs command to insert indentation for code block.

\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}

\begin{document}

\journaltitle{JFP}
\cpr{Cambridge University Press}
\doival{10.1017/xxxxx}

% \lefttitle{}
% \righttitle{Journal of Functional Programming}

\totalpg{\pageref{lastpage01}}
\jnlDoiYr{2023}

\title{From High to Low: Simulating Nondeterminism and State with State}

\begin{authgrp}
\author{Wenhao Tang}
\affiliation{The University of Edinburgh \\
        (\email{wenhao.tang@@ed.ac.uk})}
% \end{authgrp}
% \begin{authgrp}
\author{Tom Schrijvers}
\affiliation{KU Leuven Department of Computer Science \\
        (\email{tom.schrijvers@@kuleuven.be})}
\end{authgrp}

\begin{abstract}
  % Just as of programming languages, some effects are considered to be
  % more low-level than others.
  % Some of the effects are high level; and some are low level.

  Some effects are considered to be higher-level than others.
  %
  High-level effects provide expressive and succinct abstraction of
  programming concepts, while low-level effects allow more fine-grained
  control over program execution and resources.
  %
  Yet, often it is desirable to write programs using the convenient abstraction
  offered by high-level effects, and meanwhile still benefit
  from the optimisations enabled by low-level effects.
  %
  One solution is to translate high-level effects to low-level ones.

  This paper studies how algebraic effects and handlers allow us to simulate
  high-level effects in terms of low-level effects.
  %
  In particular, we focus on the interaction between state and
  nondeterminism known as the local state, as provided by Prolog. We map
  this high-level semantics in successive steps
  onto a low-level composite state effect, similar to that managed by Prolog's Warren Abstract
  Machine.
  %
  We first give a translation from the high-level local-state semantics to
  the low-level global-state semantics, by explicitly restoring state updates on
  backtracking. Next, we eliminate nondeterminsm altogether in favor of a
  lower-level state containing a choicepoint stack.
  %
  Then we avoid copying the state by restricting ourselves to incremental, reversible state updates.
  We show how these updates can be stored on a trail stack with another state effect.
  %
  We prove the correctness of all our steps using program calculation where
  the fusion laws of effect handlers play a central role.

  %
  % We model state and nondeterminism with algebraic effects and handlers, and
  % simulate the high-level local-state semantics with a single state effect
  % via a sequence of translations.  % We prove the correctness of translations
  % by equational reasoning on effect handlers.
  % %
  % %We distinguish between local-state and global-state semantics and
  % %transform the higher-level nondeterminism to state.
  % %
  % Moreover, we demonstrate possible optimisations such as efficient
  % backtracking and mutable states.
  % %
  % %We illustrate our simulations on the well-known n-queens example.
  % %prove all simulation functions correct using equational reasoning
  % %techniques.
  % \wenhao{TODO: fill in all contributions.}
\end{abstract}

\maketitle

%include sections/introduction.lhs

%include sections/Background.lhs

%include sections/Overview.lhs

%include sections/LocalGlobal.lhs

%include sections/NondetState.lhs

%include sections/Combination.lhs

%include sections/Undo.lhs

%include sections/ImmutableTrailStack.lhs

% include sections/MutableState.lhs

% include sections/optimizations.lhs

% include sections/discussion.lhs

%include sections/related_work.lhs

%include sections/conclusion.lhs

\subsection*{Conflicts of Interest}

None.

%%
%% The acknowledgments section is defined using the "acks" environment
%% (and NOT an unnumbered section). This ensures the proper
%% identification of the section in the article metadata, and the
%% consistent spelling of the heading.
%\begin{acks}
%To Robert, for the bagels and explaining CMYK and color spaces.
%\end{acks}

%%
%% The next two lines define the bibliography style to be used, and
%% the bibliography file.
\bibliographystyle{jfplike}
\bibliography{bibliography}


\clearpage

\appendix

%%
%% If your work has an appendix, this is the place to put it.
%\appendix

%include appendices/local_law.lhs

%include appendices/local_global_sim.lhs

% %include appendices/initiality_nd.lhs

% %include appendices/initiality_state.lhs

%include appendices/nondet_state_sim.lhs

%include appendices/states_state_sim.lhs

%include appendices/final_simulate.lhs

% include appendices/additional_equations.lhs

%include appendices/modify_local_global_sim.lhs

%include appendices/immutable_trail_stack_sim.lhs

\label{lastpage01}
\end{document}
